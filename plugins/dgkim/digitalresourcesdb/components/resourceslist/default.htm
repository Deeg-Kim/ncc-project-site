<div class="row">
	<div class="col-md-8 offset-md-2">
		<div style="width: 100%; height: 20px;"></div>
		<!-- <button style="font-size: 10px; padding: 3px;" class="btn btn-dark translate">日本語で表示</button> -->
		<div style="width: 100%; height: 5px;"></div>
		<form data-request="onFilter" data-request-update="resourcelist: '#resourceList'">
			<div class="form-group">
				<input type="text" class="form-control" name="search" style="margin-bottom: 10px;" placeholder="Search digital resource database..." id="main-search">
			</div>
			<div class="form-group">
				<span id="search-fields">Search fields</span>: <input type="checkbox" name="searchType[]" value="title" id="check-title" checked> <label class="form-check-label" for="check-title" id="resource-title">Title</label>
				<input type="checkbox" name="searchType[]" value="keywords" id="check-keywords" checked> <label class="form-check-label" for="check-keywords" id="keywords">Keywords</label>
				<input type="checkbox" name="searchType[]" value="description" id="check-description"> <label class="form-check-label" for="check-description" id="resource-description">Description</label>
			</div>
			<div class="form-group">
				<span id="include-category">Include category</span>:
				{% for c in categories %}
				<input type="checkbox" name="categoryFilter[]" value="{{ c.id }}" id="check-{{ c.id }}" checked> <label class="form-check-label" for="check-{{ c.id }}" id="label-{{ c.id }}">{{ c.name_english }}</label>
				{% endfor %}
			</div>
			<div class="form-group">
				<button type="submit" class="btn btn-primary" id="submit">Search</button> <input type="reset" id="reset" value="Clear" class="btn btn-danger">
			</div>
		</form>
		
		<div id="resourceList">
			All resources by romanization: 
			{% if resources|length %}
			<ul class="pagination">
			{% for p in pagination %}
				{% if p.active %}
					<li class="active">
				{% else %}
					<li>
				{% endif %}
						
				{% if p.has %}
					<a href="/?page={{ p.letter }}">
				{% else %}
					<b>
				{% endif %}
						
				{{ p.letter }}
						
				{% if not p.has %}
					</b>
				{% else %}
					</a>
				{% endif %}
						
				{% if p.active %}
					</li>
				{% else %}
					</li>
				{% endif %}
			{% endfor %}
			</ul>
			{% for resource in resources %}
				<div class="card" style="width: 100%; margin: 20px 0 20px 0">
					<div class="card-body">
						<h3 class="card-title"><a href="{{ url('/resource/') }}/{{ resource.id }}" target="_blank">{{ resource.name_japanese }} | {{ resource.name_romanization }}</a></h3>
						<h5 class="card-subtitle mb-2 text-muted">{{ resource.name_english }}</h5>
						{% for category in resource.categories %}
						<span class="badge badge-primary">{{ category.name_english }}</span>
						{% endfor %}
						<p>
							<a href="{{ resource.link }}" class="card-link" target="_blank">{{ resource.link }}</a> {% if resource.broken %}<a data-trigger="focus" tabindex="0" class="broken badge badge-danger" data-toggle="popover" title="Possibly broken link!" data-content="We've detected that this link may no longer be directing you to a live resource.">!</a>{% endif %}
						</p>
						<p class="card-text">
							<div class="row">
								{% if resource.description is not empty %}
								<div class="col-6" style="border-right: 1px black solid;">{{ resource.description_japanese|striptags|length > 70 ? resource.description_japanese|striptags|slice(0, 70) ~ '...' : resource.description_japanese|striptags }}</div>
								<div class="col-6">{{ resource.description|striptags|length > 150 ? resource.description|striptags|slice(0, 150) ~ '...' : resource.description|striptags }}</div>
								{% else %}
								<div class="col-12">{{ resource.description_japanese|striptags|length > 100 ? resource.description_japanese|striptags|slice(0, 100) ~ '...' : resource.description_japanese|striptags }}</div>
								{% endif %}
							</div>
						</p>
					</div>
				</div>
			{% endfor %}
			{% else %}
			<h2 class="text-center">No resources found!</h2>
			{% endif %}
		</div>
	</div>
</div>

{% put styles %}
<style>
	span .btn {
		font-size: 0.8em;
	}
	
	.card-text {
		font-size: 0.9em;
	}
	
	.broken:link {
		color: white;
	}
	
	.broken:hover {
		color: white;
		cursor: pointer;
		text-decoration: none;
	}
	
	.pagination {
		list-style: none;
	}
	
	.pagination li {
		margin: 0 3px;
	}
</style>
{% endput %}

{% put scripts %}
<script>
	$(function () {
		$('.broken').popover({
			trigger: 'focus'
	  	})
		
		$("#reset").click(function() {
			$.request('onFilter', {
				update: {resourcelist: '#resourceList'}
			})
		})
		
		$(".translate").click(function () {
			$(this).text(function(i, text) {
				return text === "日本語で表示" ? "Display in English" : "日本語で表示";
			})
			
			$("#search-fields").text(function(i, text) {
				return text === "Search fields" ? "検索フィールド" : "Search fields";
			})
			
			$("#resource-title").text(function(i, text) {
				return text === "Resource Title" ? "資料名" : "Resource Title";
			})
			
			$("#keywords").text(function(i, text) {
				return text === "Keywords" ? "キーワード" : "Keywords";
			})	
			
			$("#resource-description").text(function(i, text) {
				return text === "Resource Description" ? "資料内容" : "Resource Description";
			})
			
			$("#include-category").text(function(i, text) {
				return text === "Include category" ? "分野" : "Include category";
			})
			
			if ($('#main-search').attr("placeholder") == "Search digital resource database...") {
				$('#main-search').attr("placeholder", "データベースを検索...");
			} else {
				$('#main-search').attr("placeholder", "Search digital resource database...");
			}
			
			$(".read-more").text(function(i, text) {
				return text === "Read More..." ? "続きを読む..." : "Read More...";
			})
			
			{% for c in categories %}
			$("#label-{{ c.id }}").text(function(i, text) {
				return text === "{{ c.name_english }}" ? "{{ c.name_japanese }}" : "{{ c.name_english }}";
			})
			{% endfor %}
	   });
	})
</script>
{% endput %}